"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[677],{7677:function(e,t,r){r.r(t);var a=r(2676),l=r(5271),n=r(6058),s=r(9675),o=r(2327),i=r(987),c=r(9619),d=r(9822),u=r(5122),h=r(8097);let p=r.n(h)()(()=>Promise.all([r.e(553),r.e(736),r.e(336)]).then(r.bind(r,5336)),{loadableGenerated:{webpack:()=>[5336]},ssr:!1});t.default=()=>{let e=(0,n.useRouter)(),t=e.query.slug&&Array.isArray(e.query.slug)?e.query.slug.join("/"):e.query.slug,[r,h]=(0,l.useState)("SELECT number % 7 as a, number % 11 as b, number % 13 as c, count(distinct number) FROM numbers(100000000) group by a, b, c;"),[f,g]=(0,l.useState)("graph"),[m,y]=(0,l.useState)(""),[b,x]=(0,l.useState)(null),[w,v]=(0,l.useState)(!1),[N,j]=(0,l.useState)(""),k=(0,l.useCallback)((e,t)=>{if(!e||0===e.length)return{perfData:"",graphData:null};let r=e[0];if(!r.data||0===r.data.length)return{perfData:"",graphData:null};let a="";if(r.data.forEach(e=>{e&&e.length>0&&(a+=e[0]+"\n")}),console.log("Raw concatenated data:",a),1!==t)return{perfData:a.trim(),graphData:null};try{let e=JSON.parse(a.trim());return console.log("Parsed JSON data:",e),{perfData:JSON.stringify(e,null,2),graphData:e}}catch(e){return console.error("JSON parsing error:",e),{perfData:a.trim(),graphData:null}}},[]),S=(0,l.useCallback)(async e=>{try{v(!0),j("");let t=await fetch("/api/query/".concat(e));if(t.ok){let e=await t.json();if(h(e.sql),1===e.kind?g("graph"):g("perf"),e.results&&e.results.length>0){let{perfData:t,graphData:r}=k(e.results,e.kind||2);y(t),x(r)}else y(""),x(null)}else j('Run ID "'.concat(e,'" not found')),y("")}catch(t){console.error("Failed to load shared perf query:",t),j('Failed to load run ID "'.concat(e,'"')),y("")}finally{v(!1)}},[k]),E=(0,l.useCallback)(async()=>{if(!r.trim()){alert("Please enter a SQL query");return}v(!0),j("");try{let t="graph"===f?1:2,a=await fetch("/api/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:r,kind:t})});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let l=await a.json(),{perfData:n,graphData:s}=k(l.results,t);y(n),x(s),l.queryId&&e.push("/perf/".concat(l.queryId),void 0,{shallow:!0})}catch(e){console.error("Perf query execution failed:",e),alert("Perf query execution failed: "+e.message)}finally{v(!1)}},[r,e,k,f]);return(0,l.useEffect)(()=>{e.isReady&&t&&"string"==typeof t?S(t):h("SELECT * FROM system.tables LIMIT 10;")},[e.isReady,t,S]),(0,l.useEffect)(()=>{let e=e=>{(e.metaKey||e.ctrlKey)&&"Enter"===e.key&&(e.preventDefault(),E())};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[E]),(0,l.useEffect)(()=>(window.resizeIframe=function(e){try{if(e&&e.contentWindow&&e.contentWindow.document){let t=e.contentWindow.document.body.scrollHeight;e.style.height=t+"px"}}catch(e){console.warn("Could not resize iframe:",e)}},()=>{delete window.resizeIframe}),[]),(0,a.jsxs)("div",{className:"h-full bg-gray-100",children:[(0,a.jsx)("div",{className:"bg-yellow-400 px-4 py-2 flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("span",{className:"font-bold",children:"Performance Analysis"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("select",{value:f,onChange:e=>g(e.target.value),className:"border border-gray-300 rounded px-2 py-1 text-sm",children:[(0,a.jsx)("option",{value:"perf",children:"Perf"}),(0,a.jsx)("option",{value:"graph",children:"Graph"})]}),(0,a.jsx)("button",{onClick:E,disabled:w,className:"bg-indigo-600 hover:bg-indigo-700 disabled:opacity-60 disabled:cursor-not-allowed text-white px-4 py-1.5 rounded-md flex items-center gap-2 text-sm",children:w?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"ANALYZING..."]}):(0,a.jsx)(a.Fragment,{children:"â–¶ ANALYZE PERFORMANCE"})})]})]})}),(0,a.jsx)("div",{className:"h-[calc(100vh-48px)] border border-gray-300",children:(0,a.jsxs)(d.eh,{direction:"vertical",className:"h-full",children:[(0,a.jsx)(d.s_,{defaultSize:15,minSize:5,maxSize:40,className:"h-full",children:(0,a.jsx)("div",{className:"h-full border-b border-gray-300 relative",children:(0,a.jsx)(s.ZP,{value:r,placeholder:"Enter your SQL query here... (Press Cmd+Enter to analyze performance)",theme:u.tR,height:"100%",extensions:[u.MH,i.tk.lineWrapping,(0,c.ys)({icons:!1}),(0,o.i6)()],basicSetup:{lineNumbers:!0,foldGutter:!1,indentOnInput:!1,autocompletion:!0,highlightActiveLine:!1},onChange:e=>h(e),editable:!w,style:{height:"100%",fontSize:"14px"}})})}),(0,a.jsx)(d.OT,{className:"h-1 bg-gray-300 hover:bg-gray-400 cursor-row-resize"}),(0,a.jsx)(d.s_,{defaultSize:80,minSize:60,className:"h-full",children:(0,a.jsx)("div",{className:"h-full bg-white relative",children:(0,a.jsx)("div",{className:"p-2 h-full",children:N?(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("div",{className:"bg-red-50 border border-red-300 rounded-lg p-4 text-red-700",children:[(0,a.jsx)("div",{className:"font-medium text-red-800 mb-1",children:"Error"}),(0,a.jsx)("div",{className:"text-sm",children:N})]})}):m?"graph"===f&&b?(0,a.jsx)("div",{className:"h-full overflow-auto",children:(0,a.jsx)(p,{perfData:b})}):(0,a.jsx)("div",{className:"h-full overflow-auto p-4 bg-white",dangerouslySetInnerHTML:{__html:m}}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Execute a query to see performance analysis"})})})})]})})]})}},5122:function(e,t,r){r.d(t,{MH:function(){return i},tR:function(){return o}});var a=r(1861),l=r(3233),n=r(987);let s={background:"#fff",foreground:"#3D3D3D",selection:"#BBDFFF",selectionMatch:"#BBDFFF",gutterBackground:"#fff",gutterForeground:"#AFAFAF",lineHighlight:"#EDF4FF"},o=function(e){let{theme:t="light",settings:r={},styles:n=[]}={};return(0,l.j)({theme:t,settings:{...s,...r},styles:[{tag:[a.pJ.comment,a.pJ.quote],color:"#707F8D"},{tag:[a.pJ.typeName,a.pJ.typeOperator],color:"#aa0d91"},{tag:[a.pJ.keyword],color:"#aa0d91",fontWeight:"bold"},{tag:[a.pJ.string,a.pJ.meta],color:"#D23423"},{tag:[a.pJ.name],color:"#032f62"},{tag:[a.pJ.typeName],color:"#522BB2"},{tag:[a.pJ.variableName],color:"#23575C"},{tag:[a.pJ.definition(a.pJ.variableName)],color:"#327A9E"},{tag:[a.pJ.regexp,a.pJ.link],color:"#0e0eff"},...n]})}(),i=n.tk.theme({"&":{fontSize:"12pt",border:"1px solid #556cd6","border-radius":"3px",padding:"3px"},"&.cm-editor.cm-focused":{outline:"none","border-width":"2px","border-color":"#fcd004"},".cm-tooltip-autocomplete":{border:"1px solid #556cd6","border-radius":"3px",margin:"3px",padding:"3px",background:"white",color:"black"},".cm-completionMatchedText":{"text-decoration":"none"},".cm-tooltip-autocomplete ul li[aria-selected]":{background:"white",color:"black","font-weight":"bold"}})}}]);