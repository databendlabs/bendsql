"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[677],{7677:function(e,r,a){a.r(r);var t=a(2676),l=a(5271),s=a(6058),n=a(9675),i=a(4887),o=a(987),d=a(9619),c=a(9822),u=a(5122),h=a(8097),f=a.n(h),m=a(2081);let g=f()(()=>Promise.all([a.e(553),a.e(736),a.e(336)]).then(a.bind(a,5336)),{loadableGenerated:{webpack:()=>[5336]},ssr:!1}),p="select number % 3 a, number % 4 b, number % 5 c from numbers(100000000) group by all limit 3;";r.default=()=>{let{currentDsn:e}=(0,m.X)(),r=(0,s.useRouter)(),a=r.query.slug&&Array.isArray(r.query.slug)?r.query.slug.join("/"):r.query.slug,[h,f]=(0,l.useState)(p),[y,x]=(0,l.useState)("graph"),[b,j]=(0,l.useState)(""),[v,N]=(0,l.useState)(null),[w,S]=(0,l.useState)(!1),[k,q]=(0,l.useState)(""),D=(0,l.useCallback)((e,r)=>{if(!e||0===e.length)return{perfData:"",graphData:null};let a=e[0];if(!a.data||0===a.data.length)return{perfData:"",graphData:null};let t="";if(a.data.forEach(e=>{e&&e.length>0&&(t+=e[0]+"\n")}),1!==r)return{perfData:t.trim(),graphData:null};try{let e=JSON.parse(t.trim());return{perfData:JSON.stringify(e,null,2),graphData:e}}catch(e){return console.error("JSON parsing error:",e),{perfData:t.trim(),graphData:null}}},[]),z=(0,l.useCallback)(async e=>{try{S(!0),q("");let r=await fetch("/api/query/".concat(e));if(r.ok){let e=await r.json();if(f(e.sql),1===e.kind?x("graph"):x("perf"),e.results&&e.results.length>0){let{perfData:r,graphData:a}=D(e.results,e.kind||2);j(r),N(a)}else j(""),N(null)}else q('Run ID "'.concat(e,'" not found')),j(""),N(null),f(p),x("graph")}catch(r){console.error("Failed to load shared perf query:",r),q('Failed to load run ID "'.concat(e,'"')),j(""),N(null),f(p),x("graph")}finally{S(!1)}},[D]),E=(0,l.useCallback)(async()=>{if(!h.trim()){alert("Please enter a SQL query");return}S(!0),q("");try{let a="graph"===y?1:2,t=await fetch("/api/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:h,kind:a,dsn:e.dsn||void 0})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let l=await t.json(),{perfData:s,graphData:n}=D(l.results,a);j(s),N(n),l.queryId&&r.push("/perf/".concat(l.queryId),void 0,{shallow:!0})}catch(e){console.error("Perf query execution failed:",e),alert("Perf query execution failed: "+e.message)}finally{S(!1)}},[h,r,D,y,e]);(0,l.useEffect)(()=>{r.isReady&&a&&"string"==typeof a&&"0"!==a?z(a):f(p)},[r.isReady,a,z]);let C=(0,l.useMemo)(()=>o.$f.of([{key:"Mod-Enter",run:()=>(E(),!0),preventDefault:!0},{key:"Mod-NumpadEnter",run:()=>(E(),!0),preventDefault:!0}]),[E]);return(0,l.useEffect)(()=>(window.resizeIframe=function(e){try{if(e&&e.contentWindow&&e.contentWindow.document){let r=e.contentWindow.document.body.scrollHeight;e.style.height=r+"px"}}catch(e){console.warn("Could not resize iframe:",e)}},()=>{delete window.resizeIframe}),[]),(0,t.jsxs)("div",{className:"flex flex-1 min-h-0 flex-col bg-[#f9fbff]",children:[(0,t.jsxs)("div",{className:"border-b border-gray-200 bg-white px-4 py-3 flex flex-wrap items-center justify-between gap-3",children:[(0,t.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:"Performance Analysis"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("select",{value:y,onChange:e=>x(e.target.value),className:"rounded-full border border-gray-200 px-3 py-1 text-sm text-gray-700",children:[(0,t.jsx)("option",{value:"perf",children:"Perf"}),(0,t.jsx)("option",{value:"graph",children:"Graph"})]}),(0,t.jsx)("button",{onClick:E,disabled:w,className:"inline-flex items-center gap-2 rounded-full border px-4 py-1.5 text-sm font-semibold ".concat(w?"cursor-not-allowed border-gray-200 text-gray-400":"border-indigo-200 text-indigo-600 hover:bg-indigo-50"),children:w?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"w-3.5 h-3.5 border-2 border-indigo-400 border-t-transparent rounded-full animate-spin"}),"Analyzing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"text-base",children:"â–¶"}),"Analyze"]})})]})]}),(0,t.jsx)("div",{className:"flex-1 min-h-0 border border-gray-200 bg-white",children:(0,t.jsxs)(c.eh,{direction:"vertical",className:"h-full min-h-0",style:{height:"100%"},children:[(0,t.jsx)(c.s_,{defaultSize:25,minSize:10,maxSize:60,className:"h-full min-h-0",children:(0,t.jsx)("div",{className:"h-full min-h-0 border-b border-gray-300 relative",children:(0,t.jsx)(n.ZP,{value:h,placeholder:"Enter your SQL query here... (Press Cmd+Enter to analyze performance)",theme:u.tR,height:"100%",extensions:[u.MH,o.tk.lineWrapping,(0,o.Eu)(),(0,d.ys)({icons:!1}),(0,i.i6)(),C],basicSetup:!1,onChange:e=>f(e),editable:!w,style:{height:"100%",fontSize:"14px"}})})}),(0,t.jsx)(c.OT,{className:"h-1 bg-gray-300 hover:bg-gray-400 cursor-row-resize"}),(0,t.jsx)(c.s_,{defaultSize:75,minSize:40,className:"h-full min-h-0",children:(0,t.jsx)("div",{className:"h-full min-h-0 bg-white relative",children:(0,t.jsx)("div",{className:"p-2 h-full min-h-0",children:k?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsxs)("div",{className:"bg-red-50 border border-red-300 rounded-lg p-4 text-red-700",children:[(0,t.jsx)("div",{className:"font-medium text-red-800 mb-1",children:"Error"}),(0,t.jsx)("div",{className:"text-sm",children:k})]})}):b?"graph"===y&&v?(0,t.jsx)("div",{className:"h-full min-h-0 overflow-auto",children:(0,t.jsx)(g,{perfData:v})}):(0,t.jsx)("div",{className:"h-full min-h-0 overflow-auto p-4 bg-white",dangerouslySetInnerHTML:{__html:b}}):(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Execute a query to see performance analysis"})})})})]})})]})}}}]);