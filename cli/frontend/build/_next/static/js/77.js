"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[77],{6077:function(e,t,r){r.r(t),r.d(t,{default:function(){return N}});var l=r(2676),o=r(5271),n=r(9822),s=r(9675),a=r(2327),i=r(987),d=r(9619),c=r(5122);function u(e){if(!e)return"";let t=e instanceof Date?e:new Date(e);if(isNaN(t.getTime()))return"";let r=Date.now()-t.getTime();return r<6e4?"just now":r<36e5?"".concat(Math.floor(r/6e4),"m ago"):r<864e5?"".concat(Math.floor(r/36e5),"h ago"):r<6048e5?"".concat(Math.floor(r/864e5),"d ago"):t.toLocaleDateString()}let x=e=>(0,l.jsx)("svg",{viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",...e,children:(0,l.jsx)("path",{d:"M7 5v10l7-5-7-5z",fill:"currentColor",stroke:"none"})}),g=e=>(0,l.jsx)("svg",{viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",...e,children:(0,l.jsx)("path",{d:"M6 8l4 4 4-4",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})}),p=e=>(0,l.jsx)("svg",{viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",...e,children:(0,l.jsx)("path",{d:"M6 12l4-4 4 4",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})}),h=e=>(0,l.jsxs)("svg",{viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",...e,children:[(0,l.jsx)("rect",{x:"4",y:"4",width:"5",height:"12",rx:"1.5"}),(0,l.jsx)("rect",{x:"11",y:"4",width:"5",height:"12",rx:"1.5"})]}),b=e=>(0,l.jsxs)("svg",{viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",...e,children:[(0,l.jsx)("path",{d:"M7 6 4 10l3 4",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),(0,l.jsx)("path",{d:"m13 6 3 4-3 4",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})]}),m=e=>(0,l.jsxs)("svg",{viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",...e,children:[(0,l.jsx)("circle",{cx:"7",cy:"6",r:"1"}),(0,l.jsx)("circle",{cx:"13",cy:"6",r:"1"}),(0,l.jsx)("circle",{cx:"7",cy:"10",r:"1"}),(0,l.jsx)("circle",{cx:"13",cy:"10",r:"1"}),(0,l.jsx)("circle",{cx:"7",cy:"14",r:"1"}),(0,l.jsx)("circle",{cx:"13",cy:"14",r:"1"})]}),f=e=>(0,l.jsxs)("svg",{viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",...e,children:[(0,l.jsx)("path",{d:"M8 4H4v4",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),(0,l.jsx)("path",{d:"M12 4h4v4",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),(0,l.jsx)("path",{d:"M8 16H4v-4",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),(0,l.jsx)("path",{d:"M12 16h4v-4",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"})]}),v=e=>(0,l.jsxs)("svg",{viewBox:"0 0 20 20",fill:"currentColor",stroke:"none",...e,children:[(0,l.jsx)("circle",{cx:"5",cy:"10",r:"1.5"}),(0,l.jsx)("circle",{cx:"10",cy:"10",r:"1.5"}),(0,l.jsx)("circle",{cx:"15",cy:"10",r:"1.5"})]});var y=e=>{var t;let{cell:r,index:n,isActive:y,canDelete:j,onSqlChange:w,onExecute:k,onDelete:N,onSelect:C,onToggleCollapse:D,onToggleEditor:E,onToggleResult:S,onToggleFullscreen:A,onMoveUp:L,onMoveDown:M,isFullscreen:R=!1,dragState:F,onDragStart:P,onDragEnd:q,onDragOver:B,onDrop:J,onRunFromHere:O=()=>{},onRunToHere:T=()=>{}}=e,z=(0,o.useRef)(null),[_,I]=(0,o.useState)(!1),W=(0,o.useRef)(null),[H,Q]=(0,o.useState)(!1),U=(0,o.useRef)(null);(0,o.useEffect)(()=>{if(!_)return;let e=e=>{W.current&&!W.current.contains(e.target)&&I(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[_]),(0,o.useEffect)(()=>{if(!H)return;let e=e=>{U.current&&!U.current.contains(e.target)&&Q(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[H]);let Y=!r.hideEditor&&!r.collapsed,X=!r.hideResult&&!r.collapsed,Z=(0,o.useMemo)(()=>r.loading?"Running query":r.lastExecutedAt?"Ran ".concat(u(r.lastExecutedAt)):"Ready to run",[r.loading,r.lastExecutedAt]),$=["flex","gap-3","rounded-2xl","border","bg-white/95","backdrop-blur-[2px]","transition-all",F.isDragOver?"ring-1 ring-indigo-300 border-indigo-300":"border-gray-100",R?"shadow-[0_0_0_2px_rgba(99,102,241,0.35)] border-indigo-300":y?"shadow-[0_15px_35px_-20px_rgba(79,70,229,0.45)]":"shadow-sm hover:shadow-md hover:border-gray-200",r.loading?"ring-1 ring-blue-300 border-blue-200 bg-blue-50/80":""].join(" "),G="absolute left-0 right-0 h-1 bg-indigo-500/80 rounded-full transition-opacity pointer-events-none opacity-0",K=F.isDragOver?"after"===F.dragOverPosition?"translate-y-1.5":"-translate-y-1.5":"translate-y-0",V=F.isDragOver&&"before"===F.dragOverPosition,ee=F.isDragOver&&"after"===F.dragOverPosition,et="auto",er=!R,el=(0,o.useMemo)(()=>i.$f.of([{key:"Mod-Enter",run:()=>(k(),!0),preventDefault:!0},{key:"Mod-NumpadEnter",run:()=>(k(),!0),preventDefault:!0},{key:"Alt-Enter",run:()=>(null==O||O(),!0),preventDefault:!0},{key:"Shift-Enter",run:()=>(null==T||T(),!0),preventDefault:!0}]),[k,O,T]),eo=e=>{if(!z.current)return!1;let t=z.current.getBoundingClientRect();return e.clientY-t.top>t.height/2};return(0,l.jsxs)("div",{className:"relative",children:[V&&(0,l.jsx)("div",{className:"".concat(G," top-0 opacity-100")}),(0,l.jsxs)("div",{ref:z,className:"".concat($," ").concat(R?"h-full min-h-[calc(100vh-180px)]":""," ").concat(F.isDragging?"opacity-50 cursor-grabbing":""," transform transition-transform duration-150 ").concat(K),onClick:C,draggable:!R,onDragStart:e=>{if(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",r.id),z.current){let t=z.current.getBoundingClientRect();e.dataTransfer.setDragImage(z.current,e.clientX-t.left,e.clientY-t.top)}P()},onDragEnd:e=>{e.preventDefault(),q()},onDragOver:e=>{e.preventDefault(),B(eo(e))},onDrop:e=>{e.preventDefault(),J(eo(e))},children:[er&&(0,l.jsxs)("div",{className:"flex flex-col items-center gap-2 border-r border-gray-100 px-2 py-3",children:[(0,l.jsx)("div",{className:"cursor-grab rounded-full border bg-white p-2 text-gray-400 hover:text-gray-600 ".concat(F.isDragging?"border-indigo-300 text-indigo-500 cursor-grabbing":"border-gray-200"),children:(0,l.jsx)(m,{className:"h-4 w-4"})}),(0,l.jsxs)("div",{className:"flex flex-col gap-1 text-gray-400",children:[(0,l.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),D()},className:"rounded-md border px-1.5 py-1 text-xs ".concat(r.collapsed?"border-indigo-300 text-indigo-500":"border-gray-200 hover:text-gray-600"),title:r.collapsed?"Expand cell":"Collapse cell",children:r.collapsed?(0,l.jsx)(g,{className:"h-3 w-3"}):(0,l.jsx)(p,{className:"h-3 w-3"})}),!r.collapsed&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),E()},className:"rounded-md border px-1.5 py-1 text-xs ".concat(r.hideEditor?"border-indigo-300 text-indigo-500":"border-gray-200 hover:text-gray-600"),title:r.hideEditor?"Show SQL editor":"Collapse SQL editor",children:(0,l.jsx)(b,{className:"h-3.5 w-3.5"})}),(0,l.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),S()},className:"rounded-md border px-1.5 py-1 text-xs ".concat(r.hideResult?"border-indigo-300 text-indigo-500":"border-gray-200 hover:text-gray-600"),title:r.hideResult?"Show results":"Collapse results",children:(0,l.jsx)(h,{className:"h-3.5 w-3.5"})})]})]})]}),(0,l.jsxs)("div",{className:"flex-1 ".concat(er?"p-3":"p-1 sm:p-3"," ").concat(er?"":"md:px-6"),draggable:!1,children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(0,l.jsxs)("div",{className:"relative",ref:U,onMouseEnter:()=>{!r.loading&&r.sql.trim()&&Q(!0)},onMouseLeave:()=>Q(!1),children:[(0,l.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),!r.loading&&r.sql.trim()&&(k(),Q(!1))},disabled:r.loading||!r.sql.trim(),className:"flex h-8 w-8 items-center justify-center rounded-full border text-sm font-semibold transition ".concat(r.loading||!r.sql.trim()?"border-gray-200 text-gray-400 cursor-not-allowed":H?"border-indigo-400 text-indigo-600 bg-indigo-50":"border-gray-300 text-gray-600 hover:border-indigo-300 hover:text-indigo-600"),title:"Run cell",children:(0,l.jsx)(x,{className:"h-4 w-4"})}),H&&!r.loading&&r.sql.trim()&&(0,l.jsxs)("div",{className:"absolute left-0 mt-2 w-44 rounded-xl border border-gray-200 bg-white shadow-lg z-10",children:[(0,l.jsxs)("button",{className:"flex w-full items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:e=>{e.stopPropagation(),k(),Q(!1)},children:["Run cell",(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"⌘⏎"})]}),(0,l.jsxs)("button",{className:"flex w-full items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:e=>{e.stopPropagation(),O(),Q(!1)},children:["Run from here",(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"⌥⏎"})]}),(0,l.jsxs)("button",{className:"flex w-full items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:e=>{e.stopPropagation(),T(),Q(!1)},children:["Run to here",(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"⇧⏎"})]})]})]}),(0,l.jsx)("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ".concat(r.loading?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"),children:Z})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),A()},className:"rounded-full border p-1.5 text-gray-500 hover:text-gray-700 ".concat(R?"border-indigo-300 text-indigo-500":"border-gray-200 hover:border-gray-300"),title:R?"Exit fullscreen":"Fullscreen cell",children:(0,l.jsx)(f,{className:"h-4 w-4"})}),!R&&(0,l.jsxs)("div",{className:"relative",ref:W,children:[(0,l.jsx)("button",{type:"button",onClick:e=>{e.stopPropagation(),I(e=>!e)},className:"rounded-full border border-gray-200 p-1.5 text-gray-400 hover:border-gray-300 hover:text-gray-600",title:"Cell options",children:(0,l.jsx)(v,{className:"h-4 w-4"})}),_&&(0,l.jsxs)("div",{className:"absolute right-0 mt-2 w-40 rounded-xl border border-gray-200 bg-white shadow-lg z-10",children:[(0,l.jsxs)("button",{className:"flex w-full items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:e=>{e.stopPropagation(),L(),I(!1)},children:["Move cell up",(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"⌘↑"})]}),(0,l.jsxs)("button",{className:"flex w-full items-center justify-between px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:e=>{e.stopPropagation(),M(),I(!1)},children:["Move cell down",(0,l.jsx)("span",{className:"text-xs text-gray-400",children:"⌘↓"})]}),j&&(0,l.jsx)("button",{className:"flex w-full items-center justify-between px-3 py-2 text-sm text-red-600 hover:bg-red-50",onClick:e=>{e.stopPropagation(),N(),I(!1)},children:"Delete"})]})]})]})]}),!r.collapsed&&(0,l.jsxs)("div",{className:"mt-2 space-y-3 ".concat(R?"flex-1 flex flex-col overflow-hidden":""),onClick:C,children:[Y?(0,l.jsx)("div",{className:"rounded-xl bg-white",children:(0,l.jsx)(s.ZP,{value:r.sql,theme:c.tR,height:et,extensions:[c.MH,i.tk.lineWrapping,(0,i.Eu)(),(0,d.ys)({icons:!1}),(0,a.i6)(),el],basicSetup:!1,onChange:w,editable:!r.loading,onFocus:C,style:{fontSize:"14px",height:et,minHeight:"44px"}})}):(0,l.jsxs)("div",{className:"w-full rounded-xl border border-dashed border-gray-200 px-3 py-2 text-left text-sm text-gray-600 bg-white cursor-pointer hover:border-indigo-300 hover:text-indigo-600",onClick:e=>{e.stopPropagation(),E()},children:[(0,l.jsx)("div",{className:"font-mono whitespace-pre-wrap overflow-hidden",style:{maxHeight:"48px"},children:r.sql||"SQL editor collapsed"}),(0,l.jsx)("div",{className:"text-xs text-indigo-500 font-semibold mt-1",children:"Show editor"})]}),r.error&&X&&(0,l.jsx)("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:r.error}),!r.error&&X&&r.result&&(0,l.jsxs)("div",{className:"".concat(R?"flex-1 flex flex-col":""),children:[(0,l.jsxs)("div",{className:"text-xs font-semibold uppercase tracking-wide text-gray-400",children:[r.result.rowCount," row",1===r.result.rowCount?"":"s"," returned ",r.result.duration?"in ".concat(r.result.duration):""]}),(0,l.jsx)("div",{className:"".concat(R?"flex-1 overflow-auto rounded-xl border border-gray-100 bg-white mt-2":"space-y-3"),children:(t=r.result).data&&0!==t.data.length?(0,l.jsx)("div",{className:"rounded-lg border border-gray-200 overflow-hidden",children:(0,l.jsx)("div",{className:"overflow-auto max-h-72",children:(0,l.jsxs)("table",{className:"min-w-full text-sm",children:[(0,l.jsx)("thead",{className:"bg-gray-50",children:(0,l.jsx)("tr",{children:t.columns.map((e,r)=>(0,l.jsxs)("th",{className:"px-4 py-3 text-left font-semibold text-gray-700",children:[(0,l.jsx)("div",{children:e}),t.types&&t.types[r]&&(0,l.jsx)("div",{className:"text-xs text-gray-400",children:t.types[r]})]},e+r))})}),(0,l.jsx)("tbody",{children:t.data.map((e,t)=>(0,l.jsx)("tr",{className:t%2==0?"bg-white":"bg-gray-50",children:e.map((e,t)=>(0,l.jsx)("td",{className:"px-4 py-2 text-gray-800 font-mono text-xs",children:e},t))},t))})]})})}):(0,l.jsx)("div",{className:"rounded-lg border border-gray-200 bg-gray-50 p-3 text-center text-sm text-gray-500",children:"No data returned"})})]}),!r.error&&!X&&!r.collapsed]})]})]}),ee&&(0,l.jsx)("div",{className:"".concat(G," bottom-0 opacity-100")})]})};let j="bendsql-notebooks",w={getNotebooks(){try{let e=localStorage.getItem(j);if(e){let t=JSON.parse(e);return{notebooks:t.notebooks.map(e=>({...e,createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt),cells:e.cells.map(e=>{var t,r,l;return{...e,collapsed:null!==(t=e.collapsed)&&void 0!==t&&t,hideEditor:null!==(r=e.hideEditor)&&void 0!==r&&r,hideResult:null!==(l=e.hideResult)&&void 0!==l&&l,lastExecutedAt:e.lastExecutedAt?new Date(e.lastExecutedAt):void 0}})})),currentNotebookId:t.currentNotebookId}}}catch(e){console.error("Failed to load notebooks from storage:",e)}return{notebooks:[]}},saveNotebooks(e){try{localStorage.setItem(j,JSON.stringify(e))}catch(e){console.error("Failed to save notebooks to storage:",e)}},createNotebook(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Untitled Notebook",t=new Date;return{id:k(),name:e,cells:[{id:k(),sql:"",loading:!1,collapsed:!1,hideEditor:!1,hideResult:!1}],createdAt:t,updatedAt:t}},createCell:()=>({id:k(),sql:"",loading:!1,collapsed:!1,hideEditor:!1,hideResult:!1})};function k(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}var N=()=>{let[e,t]=(0,o.useState)([]),[r,s]=(0,o.useState)(null),[a,i]=(0,o.useState)(null),[d,c]=(0,o.useState)(""),[x,g]=(0,o.useState)(null),[p,h]=(0,o.useState)({id:null,placeAfter:!1}),[b,m]=(0,o.useState)(null),[f,j]=(0,o.useState)(!1),[k,N]=(0,o.useState)(null),C=(0,o.useRef)(null),D=(0,o.useRef)(null),[E,S]=(0,o.useState)(!1),A=(0,o.useRef)(null);(0,o.useEffect)(()=>{A.current=r},[r]),(0,o.useEffect)(()=>{let e=w.getNotebooks();t(e.notebooks);let r=e.notebooks[0];if(e.currentNotebookId){let t=e.notebooks.find(t=>t.id===e.currentNotebookId);t&&(r=t)}if(r){var l,o;s(r),i(null!==(o=null===(l=r.cells[0])||void 0===l?void 0:l.id)&&void 0!==o?o:null)}},[]),(0,o.useEffect)(()=>{e.length>0&&w.saveNotebooks({notebooks:e,currentNotebookId:null==r?void 0:r.id})},[e,r]),(0,o.useEffect)(()=>{if(!r){i(null);return}if(!r.cells.some(e=>e.id===a)){var e,t;i(null!==(t=null===(e=r.cells[0])||void 0===e?void 0:e.id)&&void 0!==t?t:null)}},[r,a]),(0,o.useEffect)(()=>{if(!f)return;let e=e=>{D.current&&!D.current.contains(e.target)&&j(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[f]),(0,o.useEffect)(()=>{if(!k)return;let e=e=>{e.target.closest("[data-notebook-menu]")||N(null)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[k]);let L=(0,o.useMemo)(()=>{if(!d.trim())return e;let t=d.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t))},[e,d]),M=(0,o.useCallback)(()=>{var e,r;let l=w.createNotebook();t(e=>[...e,l]),s(l),i(null!==(r=null===(e=l.cells[0])||void 0===e?void 0:e.id)&&void 0!==r?r:null)},[]),R=(0,o.useCallback)(t=>{var r,l;let o=e.find(e=>e.id===t);o&&(s(o),i(null!==(l=null===(r=o.cells[0])||void 0===r?void 0:r.id)&&void 0!==l?l:null))},[e]),F=(0,o.useCallback)((e,l)=>{t(t=>t.map(t=>t.id===e?{...t,name:l,updatedAt:new Date}:t)),(null==r?void 0:r.id)===e&&s(e=>e?{...e,name:l,updatedAt:new Date}:null)},[r]),P=(0,o.useCallback)(e=>{if(!r)return;let l=w.createCell(),o=[...r.cells],n=Math.max(0,Math.min(e,o.length));o.splice(n,0,l);let a={...r,cells:o,updatedAt:new Date};i(l.id),s(a),t(e=>e.map(e=>e.id===a.id?a:e))},[r]),q=(0,o.useCallback)(()=>{var e;null===(e=C.current)||void 0===e||e.focus()},[]),B=(0,o.useCallback)(()=>{s(null),i(null),m(null)},[]),J=(0,o.useCallback)(()=>{if(!r)return;let e=w.createCell(),l={...r,cells:[e],updatedAt:new Date};s(l),t(e=>e.map(e=>e.id===l.id?l:e)),i(e.id),m(null)},[r]),O=(0,o.useCallback)(e=>{t(t=>{if(-1===t.findIndex(t=>t.id===e))return t;let l=t.filter(t=>t.id!==e);if((null==r?void 0:r.id)===e){var o,n;let e=l.length>0?l[0]:null;s(e),i(null!==(n=null==e?void 0:null===(o=e.cells[0])||void 0===o?void 0:o.id)&&void 0!==n?n:null),m(null)}return l}),N(null)},[r]),T=(0,o.useCallback)(()=>{m(null)},[]),z=(0,o.useCallback)((e,l)=>{if(!r)return;let o={...r,cells:r.cells.map(t=>t.id===e?{...t,sql:l}:t),updatedAt:new Date};s(o),t(e=>e.map(e=>e.id===o.id?o:e))},[r]),_=(0,o.useCallback)((e,l)=>{if(!r)return;let o={...r,cells:r.cells.map(t=>t.id===e?{...t,[l]:!t[l]}:t),updatedAt:new Date};s(o),t(e=>e.map(e=>e.id===o.id?o:e))},[r]),I=(0,o.useCallback)(function(e,l){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!r||e===l)return!1;let n=[...r.cells],a=n.findIndex(t=>t.id===e),d=n.findIndex(e=>e.id===l);if(-1===a||-1===d)return!1;let[c]=n.splice(a,1);n.splice(o?d+1:d,0,c);let u={...r,cells:n,updatedAt:new Date};return s(u),t(e=>e.map(e=>e.id===u.id?u:e)),i(c.id),!0},[r]),W=(0,o.useCallback)((e,t)=>{if(!r)return;let l=r.cells,o=l.findIndex(t=>t.id===e);if(-1===o)return;let n="up"===t?o-1:o+1;n<0||n>=l.length||I(e,l[n].id,"down"===t)},[r,I]),H=(0,o.useCallback)(e=>{g(e),h({id:null,placeAfter:!1})},[]),Q=(0,o.useCallback)(()=>{g(null),h({id:null,placeAfter:!1})},[]),U=(0,o.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];x&&x!==e&&I(x,e,t)&&h({id:e,placeAfter:t})},[x,I]),Y=(0,o.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];x&&x!==e&&I(x,e,t),g(null),h({id:null,placeAfter:!1})},[x,I]),X=(0,o.useCallback)(async e=>{let r=A.current;if(!r)return{success:!1};let l=r.cells.find(t=>t.id===e);if(!l||!l.sql.trim())return{success:!1};i(e);let o={...r,cells:r.cells.map(t=>t.id===e?{...t,loading:!0,error:void 0,result:void 0}:t)};s(o),A.current=o;try{let r=await fetch("/api/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:l.sql,kind:0})});if(!r.ok){let e="HTTP error! status: ".concat(r.status);try{let t=await r.json();t.error&&(e=t.error)}catch(e){}throw Error(e)}let n=(await r.json()).results||[],a=n.length>0?n[n.length-1]:void 0,i={...o,cells:o.cells.map(t=>t.id===e?{...t,loading:!1,result:a,error:void 0,lastExecutedAt:new Date}:t),updatedAt:new Date};return s(i),A.current=i,t(e=>e.map(e=>e.id===i.id?i:e)),{success:!0}}catch(n){console.error("Cell execution failed:",n);let r=n.message.replace(/\\n/g,"\n"),l={...o,cells:o.cells.map(t=>t.id===e?{...t,loading:!1,error:"Query execution failed: "+r,result:void 0}:t),updatedAt:new Date};return s(l),A.current=l,t(e=>e.map(e=>e.id===l.id?l:e)),{success:!1,error:r}}},[]),Z=(0,o.useCallback)(async e=>{let t=A.current;if(t)for(let r of t.cells.slice(e).map(e=>e.id)){let e=await X(r);if(!(null==e?void 0:e.success))break}},[X]),$=(0,o.useCallback)(async e=>{let t=A.current;if(t)for(let r of t.cells.slice(0,Math.min(e+1,t.cells.length)).map(e=>e.id)){let e=await X(r);if(!(null==e?void 0:e.success))break}},[X]);(0,o.useEffect)(()=>{if(!b)return;let e=e=>{"Escape"===e.key&&(e.preventDefault(),T())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[b,T]);let G=(0,o.useCallback)(e=>{if(!r||r.cells.length<=1)return;let l=r.cells.findIndex(t=>t.id===e),o=r.cells[l+1]||r.cells[l-1],n={...r,cells:r.cells.filter(t=>t.id!==e),updatedAt:new Date};i(t=>{var r;return t===e?null!==(r=null==o?void 0:o.id)&&void 0!==r?r:null:t}),s(n),t(e=>e.map(e=>e.id===n.id?n:e)),m(t=>t===e?null:t)},[r]),K=(e,t)=>{if(b)return null;let r="between"===e?"Add cell between":"above"===e?"Add cell above":"Add cell below";return(0,l.jsxs)("button",{type:"button",onClick:()=>P(t),className:"group relative flex w-full items-center justify-center py-1 focus:outline-none",title:r,children:[(0,l.jsx)("span",{className:"pointer-events-none h-px w-full bg-gray-200 transition-colors group-hover:bg-indigo-300"}),(0,l.jsxs)("span",{className:"pointer-events-none absolute left-1/2 -translate-x-1/2 -translate-y-1/2 whitespace-nowrap rounded-full border border-gray-200 bg-white px-3 py-1 text-xs font-semibold text-gray-600 opacity-0 shadow group-hover:-translate-y-1 group-hover:opacity-100 group-hover:border-indigo-300 group-hover:text-indigo-600",children:["+ ",r]})]},"add-control-".concat(t))};return(0,l.jsxs)("div",{className:"relative flex h-full flex-1 flex-col bg-[#f4f6fb]",children:[(0,l.jsxs)(n.eh,{direction:"horizontal",className:"flex-1 overflow-hidden",children:[(0,l.jsx)(n.s_,{defaultSize:15,minSize:15,maxSize:30,className:"h-full",children:(0,l.jsxs)("div",{className:"flex h-full flex-col border-r border-gray-200 bg-white",children:[(0,l.jsxs)("div",{className:"p-3 border-b border-gray-100",children:[(0,l.jsx)("label",{className:"text-xs font-semibold uppercase tracking-wide text-gray-400 mb-2 block",children:"Search"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("span",{className:"absolute inset-y-0 left-3 flex items-center text-gray-400",children:(0,l.jsxs)("svg",{className:"h-4 w-4",viewBox:"0 0 20 20",fill:"none",stroke:"currentColor",children:[(0,l.jsx)("path",{d:"m13.5 13.5 3 3",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round"}),(0,l.jsx)("circle",{cx:"9",cy:"9",r:"5.5",strokeWidth:"1.6"})]})}),(0,l.jsx)("input",{value:d,onChange:e=>c(e.target.value),placeholder:"Find notebook",className:"w-full rounded-lg border border-gray-200 bg-gray-50 pl-8 pr-3 py-2 text-sm text-gray-700 focus:border-indigo-400 focus:bg-white focus:outline-none"})]})]}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 text-xs font-semibold uppercase tracking-wide text-gray-500",children:[(0,l.jsxs)("button",{type:"button",className:"inline-flex items-center gap-2 rounded-full border border-transparent px-2 py-1 text-xs font-semibold text-gray-500 hover:text-gray-700",onClick:()=>S(e=>!e),children:[(0,l.jsx)("span",{children:E?"▶":"▼"}),(0,l.jsx)("span",{children:"Notebooks"})]}),(0,l.jsx)("button",{type:"button",onClick:M,className:"rounded-full border border-gray-200 px-2 py-1 text-sm font-semibold text-gray-600 hover:border-indigo-300 hover:text-indigo-600",title:"Add notebook",children:"+"})]}),!E&&(0,l.jsxs)("div",{className:"px-2 pb-3 space-y-1",children:[0===L.length&&(0,l.jsx)("div",{className:"text-center text-sm text-gray-500 px-2 py-4",children:"No notebooks found"}),L.map(e=>{let t=(null==r?void 0:r.id)===e.id,o=k===e.id;return(0,l.jsx)("div",{className:"space-y-1","data-notebook-menu":o?"true":void 0,children:(0,l.jsxs)("button",{onClick:()=>R(e.id),className:"w-full text-left px-3 py-2 rounded-lg border transition-all ".concat(t?"border-indigo-300 bg-indigo-50/70 text-indigo-700":"border-transparent hover:border-gray-200 hover:bg-gray-50"),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,l.jsx)("span",{className:"font-semibold text-sm truncate",children:e.name||"Untitled Notebook"}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-[10px] text-gray-400",children:[(0,l.jsx)("span",{className:"uppercase",children:u(e.updatedAt)||"new"}),(0,l.jsxs)("div",{className:"relative","data-notebook-menu-button":!0,children:[(0,l.jsx)("button",{type:"button",onClick:t=>{t.stopPropagation(),N(t=>t===e.id?null:e.id)},className:"rounded-full border p-1 transition ".concat(o?"border-indigo-300 text-indigo-600":"border-gray-200 text-gray-500 hover:border-gray-300"),title:"Notebook options",children:(0,l.jsx)(v,{className:"h-3.5 w-3.5"})}),o&&(0,l.jsx)("div",{className:"absolute right-0 mt-2 w-40 rounded-xl border border-gray-200 bg-white shadow-lg z-10",children:(0,l.jsx)("button",{type:"button",onClick:()=>{O(e.id),N(null)},className:"flex w-full items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50",children:"Delete notebook"})})]})]})]}),(0,l.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:[e.cells.length," cell",1===e.cells.length?"":"s"]})]})},e.id)})]})]})]})}),(0,l.jsx)(n.OT,{className:"group flex w-3 cursor-col-resize items-center justify-center",children:(0,l.jsx)("span",{className:"h-10 w-0.5 rounded-full bg-gray-200 group-hover:bg-indigo-400"})}),(0,l.jsx)(n.s_,{defaultSize:60,minSize:40,className:"h-full",children:(0,l.jsx)("div",{className:"flex h-full flex-col overflow-hidden",children:r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("header",{className:"border-b border-gray-200 bg-white px-4 py-3 flex items-center justify-between gap-3",children:[(0,l.jsxs)("div",{className:"min-w-0",children:[(0,l.jsx)("input",{ref:C,type:"text",value:r.name,onChange:e=>F(r.id,e.target.value),className:"w-full border-none bg-transparent text-xl font-semibold text-gray-900 focus:outline-none",placeholder:"Notebook name"}),(0,l.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Updated ",u(r.updatedAt)||"just now"," \xb7 ",r.cells.length," cell",1===r.cells.length?"":"s"]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(0,l.jsx)("span",{className:"hidden sm:inline",children:"⌘⏎ to run cell"}),(0,l.jsxs)("div",{className:"relative",ref:D,children:[(0,l.jsx)("button",{type:"button",onClick:()=>j(e=>!e),className:"rounded-full border p-1.5 transition ".concat(f?"border-indigo-300 text-indigo-600":"border-gray-200 text-gray-500 hover:border-gray-300"),title:"Notebook options",children:(0,l.jsx)(v,{className:"h-4 w-4"})}),f&&(0,l.jsxs)("div",{className:"absolute right-0 mt-2 w-44 rounded-xl border border-gray-200 bg-white shadow-lg z-10",children:[(0,l.jsx)("button",{className:"flex w-full items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>{q(),j(!1)},children:"Rename"}),(0,l.jsx)("button",{className:"flex w-full items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>{B(),j(!1)},children:"Close"}),(0,l.jsx)("button",{className:"flex w-full items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50",onClick:()=>{J(),j(!1)},children:"Delete all cells"})]})]})]})]}),(0,l.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-4 ".concat(b?"space-y-0":"space-y-3"),children:[!b&&K("above",0),r.cells.map((e,t)=>b&&e.id!==b?null:(0,l.jsxs)(o.Fragment,{children:[(0,l.jsx)(y,{cell:e,index:t,onSqlChange:t=>z(e.id,t),onExecute:()=>X(e.id),onDelete:()=>G(e.id),canDelete:r.cells.length>1,isActive:e.id===a||b===e.id,onSelect:()=>i(e.id),onToggleCollapse:()=>_(e.id,"collapsed"),onToggleEditor:()=>_(e.id,"hideEditor"),onToggleResult:()=>_(e.id,"hideResult"),onToggleFullscreen:()=>m(t=>t===e.id?null:e.id),isFullscreen:b===e.id,onMoveUp:()=>W(e.id,"up"),onMoveDown:()=>W(e.id,"down"),dragState:{isDragging:x===e.id,isDragOver:p.id===e.id,dragOverPosition:p.id===e.id?p.placeAfter?"after":"before":void 0},onDragStart:()=>H(e.id),onDragEnd:Q,onDragOver:t=>U(e.id,t),onDrop:t=>Y(e.id,t),onRunFromHere:()=>{Z(t)},onRunToHere:()=>{$(t)}}),!b&&K(t===r.cells.length-1?"below":"between",t+1)]},e.id)),!b&&K("below",r.cells.length)]})]}):(0,l.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center max-w-xs",children:[(0,l.jsx)("p",{className:"text-lg font-semibold text-gray-800 mb-2",children:"No notebooks yet"}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Create your first notebook to start experimenting with queries."}),(0,l.jsx)("button",{onClick:M,className:"rounded-xl bg-indigo-600 px-5 py-2 text-sm font-medium text-white hover:bg-indigo-500",children:"Create Notebook"})]})})})})]}),b&&(0,l.jsx)("div",{className:"absolute inset-x-0 top-[68px] z-10 flex justify-end px-6",children:(0,l.jsx)("button",{onClick:T,className:"rounded-full border border-gray-300 bg-white px-3 py-1 text-xs font-semibold text-gray-600 shadow-sm hover:border-gray-400",children:"Exit fullscreen ⎋"})})]})}},5122:function(e,t,r){r.d(t,{MH:function(){return i},tR:function(){return a}});var l=r(1861),o=r(3233),n=r(987);let s={background:"#fff",foreground:"#3D3D3D",selection:"#BBDFFF",selectionMatch:"#BBDFFF",gutterBackground:"#fff",gutterForeground:"#AFAFAF",lineHighlight:"#EDF4FF"},a=function(e){let{theme:t="light",settings:r={},styles:n=[]}={};return(0,o.j)({theme:t,settings:{...s,...r},styles:[{tag:[l.pJ.comment,l.pJ.quote],color:"#707F8D"},{tag:[l.pJ.typeName,l.pJ.typeOperator],color:"#aa0d91"},{tag:[l.pJ.keyword],color:"#aa0d91",fontWeight:"bold"},{tag:[l.pJ.string,l.pJ.meta],color:"#D23423"},{tag:[l.pJ.name],color:"#032f62"},{tag:[l.pJ.typeName],color:"#522BB2"},{tag:[l.pJ.variableName],color:"#23575C"},{tag:[l.pJ.definition(l.pJ.variableName)],color:"#327A9E"},{tag:[l.pJ.regexp,l.pJ.link],color:"#0e0eff"},...n]})}(),i=n.tk.theme({"&":{fontSize:"12pt",border:"1px solid #556cd6","border-radius":"3px",padding:"3px"},"&.cm-editor.cm-focused":{outline:"none","border-width":"2px","border-color":"#fcd004"},".cm-tooltip-autocomplete":{border:"1px solid #556cd6","border-radius":"3px",margin:"3px",padding:"3px",background:"white",color:"black"},".cm-completionMatchedText":{"text-decoration":"none"},".cm-tooltip-autocomplete ul li[aria-selected]":{background:"white",color:"black","font-weight":"bold"}})}}]);