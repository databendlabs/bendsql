"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[592],{662:function(e,r,t){t.d(r,{Z:function(){return b}});var s=t(2676),n=t(5271),a=t(6058),o=t(9675),l=t(4887),i=t(8057),d=t(987),c=t(9619),u=t(9822),x=t(5122),h=t(300),g=t(8435),y=t(1861);let m=g.Qf.define([{tag:[y.pJ.comment,y.pJ.quote],color:"#707F8D",fontStyle:"italic"},{tag:[y.pJ.keyword],color:"#aa0d91",fontWeight:"bold"},{tag:[y.pJ.string,y.pJ.special(y.pJ.string)],color:"#D23423"},{tag:[y.pJ.number,y.pJ.bool],color:"#c026d3"},{tag:[y.pJ.name],color:"#032f62"}]);var p=t(2081),b=()=>{let{currentDsn:e}=(0,p.X)(),r=(0,a.useRouter)(),t=r.query.slug&&Array.isArray(r.query.slug)?r.query.slug.join("/"):r.query.slug,y=r.query.queryId,b=t||y,[f,j]=(0,n.useState)(""),[N,w]=(0,n.useState)("sql"),[v,E]=(0,n.useState)([]),[S,k]=(0,n.useState)(!1),[J,q]=(0,n.useState)(""),[C,F]=(0,n.useState)(!1);(0,n.useEffect)(()=>{r.isReady&&b&&"string"==typeof b?D(b):j("CREATE OR REPLACE TABLE students (uid Int16, name String, age Int16);\n\nINSERT INTO students VALUES (1231, 'John', 33);\nINSERT INTO students VALUES (6666, 'Ksenia', 48);\nINSERT INTO students VALUES (8888, 'Alice', 50);\n\nSELECT * FROM students;")},[r.isReady,b]);let D=async e=>{try{k(!0),q("");let r=await fetch("/api/query/".concat(e));if(r.ok){let e=await r.json();j(e.sql),E(e.results||[]),3===e.kind?w("python"):w("sql")}else q('Run ID "'.concat(e,'" not found')),E([])}catch(r){console.error("Failed to load shared query:",r),q('Failed to load run ID "'.concat(e,'"')),E([])}finally{k(!1)}},T=(0,n.useCallback)(async()=>{if(!f.trim()){q("Please enter a SQL query"),E([]);return}k(!0),q("");try{let t=await fetch("/api/query",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:f,kind:"python"===N?3:0,dsn:e.dsn||void 0})});if(!t.ok){let e="HTTP error! status: ".concat(t.status);try{let r=await t.json();r.error&&(e=r.error)}catch(e){}throw Error(e)}let s=await t.json();E(s.results||[]),s.queryId&&r.push("/".concat(s.queryId),void 0,{shallow:!0})}catch(e){console.error("Query execution failed:",e),q("Query execution failed: "+e.message.replace(/\\n/g,"\n")),E([])}finally{k(!1)}},[f,r,N,e]),A=(0,n.useMemo)(()=>d.$f.of([{key:"Mod-Enter",run:()=>(T(),!0),preventDefault:!0},{key:"Ctrl-Enter",run:()=>(T(),!0),preventDefault:!0}]),[T]),R=(e,r)=>e.data&&Array.isArray(e.data)&&0!==e.data.length?(0,s.jsxs)("div",{className:"bg-white border border-gray-300 rounded-lg mb-4 overflow-hidden shadow-sm",children:[(0,s.jsxs)("div",{className:"bg-gray-50 border-b border-gray-300 px-4 py-3 font-medium text-gray-700",children:["Query ",r+1," (",e.rowCount," rows, ",e.duration,")"]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full border-collapse",children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{className:"bg-gray-100",children:e.columns.map((r,t)=>(0,s.jsxs)("th",{className:"border border-gray-300 px-4 py-3 text-left font-semibold text-gray-900 bg-gray-50",children:[r,e.types&&e.types[t]&&(0,s.jsx)("div",{className:"text-xs font-normal text-left text-gray-500 mt-1",children:e.types[t]})]},t))})}),(0,s.jsx)("tbody",{children:e.data.map((e,r)=>(0,s.jsx)("tr",{className:r%2==0?"bg-white":"bg-gray-50",children:e.map((e,r)=>(0,s.jsx)("td",{className:"border border-gray-300 px-4 py-2 text-gray-900 font-mono text-sm",children:e||""},r))},r))})]})})]},r):(0,s.jsxs)("div",{className:"bg-white border border-gray-300 rounded-lg mb-4 overflow-hidden shadow-sm",children:[(0,s.jsxs)("div",{className:"bg-gray-50 border-b border-gray-300 px-4 py-3 font-medium text-gray-700",children:["Query ",r+1," (",e.rowCount," rows, ",e.duration,")"]}),(0,s.jsx)("div",{className:"p-4 text-center text-gray-500",children:"No data returned"})]},r),P="python"===N?"Enter your Python script here... (Press Cmd+Enter to run)":"Enter your SQL queries here... (Press Cmd+Enter to run)",I=(0,n.useMemo)(()=>{let e=[x.MH,d.tk.lineWrapping,(0,d.Eu)(),(0,c.ys)({icons:!1})];return"python"===N?[...e,i.yy.tabSize.of(4),[(0,h.Vs)(),g.c.of("    "),(0,g.nF)(m)],A]:[...e,(0,l.i6)(),A]},[N,A]);return(0,s.jsxs)("div",{className:"flex flex-1 min-h-0 flex-col bg-[#f9fbff]",children:[(0,s.jsxs)("div",{className:"border-b border-gray-200 bg-white px-4 py-3 flex items-center gap-3 text-sm text-gray-600",children:[(0,s.jsx)("button",{onClick:T,disabled:S,className:"inline-flex items-center gap-2 rounded-full border px-4 py-1.5 text-sm font-semibold ".concat(S?"cursor-not-allowed border-gray-200 text-gray-400":"border-indigo-200 text-indigo-600 hover:bg-indigo-50"),children:S?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"w-3.5 h-3.5 border-2 border-indigo-400 border-t-transparent rounded-full animate-spin"}),"Running..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-base",children:"▶"}),"Run query"]})}),(0,s.jsx)("span",{className:"hidden sm:block",children:"Press ⌘⏎ to run"}),(0,s.jsxs)("div",{className:"ml-auto flex items-center gap-2 text-xs text-gray-500",children:["python"===N&&(0,s.jsx)("button",{type:"button",onClick:()=>F(!0),className:"inline-flex h-7 w-7 items-center justify-center rounded-full border border-gray-200 text-gray-500 hover:border-indigo-300 hover:text-indigo-600",title:"Python engine help",children:"?"}),(0,s.jsx)("span",{children:"Engine"}),(0,s.jsxs)("select",{value:N,onChange:e=>w(e.target.value),className:"rounded-full border border-gray-200 bg-white px-2 py-1 text-sm text-gray-700 focus:border-indigo-400 focus:outline-none",disabled:S,children:[(0,s.jsx)("option",{value:"sql",children:"SQL"}),(0,s.jsx)("option",{value:"python",children:"Python"})]})]})]}),(0,s.jsx)("div",{className:"flex-1 min-h-0 border border-gray-200 bg-white",children:(0,s.jsxs)(u.eh,{direction:"horizontal",className:"h-full min-h-0",style:{height:"100%"},children:[(0,s.jsx)(u.s_,{defaultSize:50,minSize:20,className:"h-full min-h-0",children:(0,s.jsx)("div",{className:"h-full min-h-0 border-r border-gray-300 relative",children:(0,s.jsx)(o.ZP,{value:f,placeholder:P,theme:x.tR,height:"100%",extensions:I,basicSetup:!1,onChange:e=>j(e),editable:!S,style:{height:"100%",fontSize:"14px"}})})}),(0,s.jsx)(u.OT,{className:"w-1 bg-gray-300 hover:bg-gray-400 cursor-col-resize"}),(0,s.jsx)(u.s_,{defaultSize:50,minSize:20,className:"h-full min-h-0",children:(0,s.jsx)("div",{className:"h-full min-h-0 overflow-auto bg-white relative",children:(0,s.jsx)("div",{className:"p-2 h-full min-h-0",children:J?(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsxs)("div",{className:"bg-red-50 border border-red-300 rounded-lg p-4 text-red-700 max-w-full",children:[(0,s.jsx)("div",{className:"font-medium text-red-800 mb-1",children:"Error"}),(0,s.jsx)("pre",{className:"text-sm whitespace-pre-wrap break-words font-mono",children:J})]})}):v.length>0?(0,s.jsx)("div",{className:"space-y-4",children:v.map((e,r)=>R(e,r))}):(0,s.jsx)("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Execute a query to see results"})})})})]})}),"python"===N&&C&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",children:(0,s.jsxs)("div",{className:"w-full max-w-lg rounded-2xl bg-white p-6 shadow-2xl",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Python Engine Help"}),(0,s.jsx)("button",{onClick:()=>F(!1),className:"rounded-full border border-gray-200 px-2 py-1 text-sm text-gray-500 hover:border-gray-300",children:"Close"})]}),(0,s.jsxs)("div",{className:"space-y-4 text-sm text-gray-700",children:[(0,s.jsxs)("p",{children:["Python scripts run inside ",(0,s.jsx)("code",{className:"text-xs bg-gray-100 px-1 py-0.5 rounded",children:"ghcr.io/astral-sh/uv:debian"})," with",(0,s.jsx)("code",{className:"text-xs bg-gray-100 px-1 py-0.5 rounded",children:"uv run --script"}),". The following helpers are injected for you:"]}),(0,s.jsxs)("ul",{className:"list-disc pl-5 space-y-1 text-gray-600",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("code",{className:"text-xs bg-gray-100 px-1 py-0.5 rounded",children:"async_client"}),": an ",(0,s.jsx)("code",{children:"AsyncDatabendClient"})," connected to your DSN."]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("code",{className:"text-xs bg-gray-100 px-1 py-0.5 rounded",children:"client"}),": a ",(0,s.jsx)("code",{children:"BlockingDatabendClient"})," using the same DSN."]})]}),(0,s.jsx)("p",{children:"Sync Example:"}),(0,s.jsx)("pre",{className:"bg-gray-900 text-gray-100 text-xs rounded-xl p-3 overflow-auto",children:'conn = client.get_conn()\nrows = conn.query_iter("SELECT * FROM numbers(10)")\nfor row in rows:\n    print(row.values())\nconn.close()'}),(0,s.jsx)("p",{children:"Async Example:"}),(0,s.jsx)("pre",{className:"bg-gray-900 text-gray-100 text-xs rounded-xl p-3 overflow-auto",children:'async def main():\n  conn = await async_client.get_conn()\n  rows = await conn.query_iter("SELECT * FROM numbers(10)")\n  async for row in rows:\n      print(row.values())\n  await conn.close()\n\nasyncio.run(main())'}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:"Note: Docker must be installed locally for Python execution."})]})]})})]})}},5122:function(e,r,t){t.d(r,{MH:function(){return i},tR:function(){return l}});var s=t(1861),n=t(3233),a=t(987);let o={background:"#fff",foreground:"#3D3D3D",selection:"#BBDFFF",selectionMatch:"#BBDFFF",gutterBackground:"#fff",gutterForeground:"#AFAFAF",lineHighlight:"#EDF4FF"},l=function(e){let{theme:r="light",settings:t={},styles:a=[]}={};return(0,n.j)({theme:r,settings:{...o,...t},styles:[{tag:[s.pJ.comment,s.pJ.quote],color:"#707F8D"},{tag:[s.pJ.typeName,s.pJ.typeOperator],color:"#aa0d91"},{tag:[s.pJ.keyword],color:"#aa0d91",fontWeight:"bold"},{tag:[s.pJ.string,s.pJ.meta],color:"#D23423"},{tag:[s.pJ.name],color:"#032f62"},{tag:[s.pJ.typeName],color:"#522BB2"},{tag:[s.pJ.variableName],color:"#23575C"},{tag:[s.pJ.definition(s.pJ.variableName)],color:"#327A9E"},{tag:[s.pJ.regexp,s.pJ.link],color:"#0e0eff"},...a]})}(),i=a.tk.theme({"&":{fontSize:"12pt",border:"1px solid #556cd6","border-radius":"3px",padding:"3px"},"&.cm-editor.cm-focused":{outline:"none","border-width":"2px","border-color":"#fcd004"},".cm-tooltip-autocomplete":{border:"1px solid #556cd6","border-radius":"3px",margin:"3px",padding:"3px",background:"white",color:"black"},".cm-completionMatchedText":{"text-decoration":"none"},".cm-tooltip-autocomplete ul li[aria-selected]":{background:"white",color:"black","font-weight":"bold"}})}}]);